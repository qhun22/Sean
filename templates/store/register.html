{% extends 'base.html' %}
{% load static %}

{% block title %}ĐĂNG KÝ - QHUN22 Mobile{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/register.css' %}">
{% endblock %}

{% block content %}
<div class="qh-register-page" style="padding: 10px 0;">

    <div class="qh-auth-box">
        <h2 class="qh-auth-box-title">ĐĂNG KÝ</h2>

        <!-- Messages will be shown via JavaScript Toast -->
        {% if messages %}
            {% for message in messages %}
                <div class="qh-toast-message" data-type="{% if message.tags == 'error' %}error{% else %}success{% endif %}" data-message="{{ message|escapejs }}" style="display: none;"></div>
            {% endfor %}
        {% endif %}

        <form method="POST" action="{% url 'store:register' %}" id="regForm">
            {% csrf_token %}

            <div class="qh-form-group">
                <label class="qh-label">Họ Tên</label>
                <input type="text" name="fullname" class="qh-input" placeholder="Nhập họ tên" required>
            </div>

            <div class="qh-form-group">
                <label class="qh-label">Email</label>
                <div class="qh-otp-group">
                    <input type="email" name="email" id="email" class="qh-input" placeholder="Nhập email" required>
                    <button type="button" class="qh-otp-btn" id="otpBtn" disabled>Lấy mã</button>
                </div>
            </div>

            <!-- OTP Message -->
            <div id="otpMessage" class="qh-otp-message" style="display: none;"></div>

            <div class="qh-form-group">
                <label class="qh-label">Nhập mã OTP</label>
                <input type="text" name="otp" id="otp" class="qh-input" placeholder="Nhập mã OTP" required>
            </div>

            <div class="qh-form-group">
                <label class="qh-label">Số điện thoại</label>
                <input type="text" name="phone" class="qh-input" placeholder="Nhập số điện thoại" required>
            </div>

            <div class="qh-form-group">
                <label class="qh-label">Mật khẩu</label>
                <input type="password" name="password" class="qh-input" placeholder="Nhập mật khẩu" required>
            </div>

            <div class="qh-form-group">
                <label class="qh-label">Nhập lại Mật khẩu</label>
                <input type="password" name="confirm_password" class="qh-input" placeholder="Nhập lại mật khẩu" required>
            </div>

            <button type="submit" class="qh-btn qh-btn-primary" style="width: 100%;">
                Đăng ký
            </button>
        </form>

        <p class="qh-auth-link">
            Đã có tài khoản? <a href="{% url 'store:login' %}">Đăng nhập ngay</a>
        </p>
    </div>
</div>

<!-- External Register JS -->
<script src="{% static 'js/register.js' %}?v=3"></script>

<!-- Django Messages to Toast -->
{# ========================================================================= #}
{# NOTE: JS KHÔNG THỂ TÁCH RA FILE RIÊNG vì sử dụng Django template tags #}
{# - {% if messages %} - Block từ Django #}
{# - {% for message in messages %} - Loop từ Django #}
{# - {{ message.tags|escapejs }} - Biến từ Django #}
{# - {{ message|escapejs }} - Biến từ Django #}
{# Nếu tách ra file .js thuần, các template tags này sẽ không được xử lý #}
{# ========================================================================= #}
{% if messages %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    {% for message in messages %}
    (function() {
        var tags = "{{ message.tags|escapejs }}";
        var messageText = "{{ message|escapejs }}";
        var type = tags.includes('error') ? 'error' : 'success';

        if (window.QHToast) {
            window.QHToast.show(messageText, type);
        }
    })();
    {% endfor %}
});
</script>
{% endif %}

{% endblock %}
