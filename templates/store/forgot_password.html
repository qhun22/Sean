{% extends 'base.html' %}
{% load static %}

{% block title %}Quên mật khẩu - QHUN22 Mobile{% endblock %}

{% block extra_css %}
<style>
    /* Form Styles */
    .qh-auth-box {
        background: var(--qh-white);
        border-radius: var(--qh-radius-lg);
        padding: 32px;
        width: 100%;
        max-width: 480px;
        margin: 0 auto;
        box-shadow: 0 4px 20px var(--qh-shadow);
    }
    
    .qh-auth-box-title {
        font-size: 30px;
        font-weight: 600;
        text-align: center;
        margin-bottom: 24px;
        color: var(--qh-text);
    }
    
    .qh-auth-link {
        text-align: center;
        margin-top: 20px;
        color: var(--qh-text-light);
    }
    
    .qh-auth-link a {
        color: var(--qh-primary-dark);
        font-weight: 500;
        text-decoration: none;
    }
    
    .qh-auth-link a:hover {
        text-decoration: underline;
    }
    
    /* OTP Button */
    .qh-otp-group {
        display: flex;
        gap: 8px;
    }
    
    .qh-otp-group .qh-input {
        flex: 1;
    }
    
    .qh-otp-btn {
        white-space: nowrap;
        padding: 12px 20px;
        background: var(--qh-primary);
        color: var(--qh-white);
        border: none;
        border-radius: var(--qh-radius);
        cursor: pointer;
        font-family: 'Signika', sans-serif;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.3s ease;
    }
    
    .qh-otp-btn:hover:not(:disabled) {
        background: var(--qh-primary-dark);
    }
    
    .qh-otp-btn:disabled {
        background: #ccc;
        color: #888;
        cursor: not-allowed;
    }
    
    .qh-otp-message {
        text-align: center;
        padding: 8px;
        margin-bottom: 12px;
        border-radius: var(--qh-radius);
        font-size: 14px;
    }
    
    .qh-otp-message.success {
        background: #d4edda;
        color: #155724;
    }
    
    .qh-otp-message.error {
        background: #f8d7da;
        color: #721c24;
    }
    
    /* Password Fields */
    .qh-password-field {
        position: relative;
    }
    
    .qh-password-toggle {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        cursor: pointer;
        color: var(--qh-text-light);
        padding: 4px;
    }
    
    .qh-password-toggle:hover {
        color: var(--qh-primary);
    }
    
    /* Back Button */
    .qh-back-link {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        color: var(--qh-primary-dark);
        text-decoration: none;
        margin-bottom: 20px;
        font-size: 14px;
    }
    
    .qh-back-link:hover {
        text-decoration: underline;
    }
    
    /* Steps indicator */
    .qh-steps {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-bottom: 24px;
    }
    
    .qh-step {
        display: flex;
        align-items: center;
        gap: 8px;
        color: var(--qh-text-light);
        font-size: 14px;
    }
    
    .qh-step.active {
        color: var(--qh-primary);
        font-weight: 600;
    }
    
    .qh-step.completed {
        color: #28a745;
    }
    
    .qh-step-number {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: var(--qh-border);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: 600;
    }
    
    .qh-step.active .qh-step-number {
        background: var(--qh-primary);
        color: white;
    }
    
    .qh-step.completed .qh-step-number {
        background: #28a745;
        color: white;
    }
    
    /* Hidden class */
    .qh-hidden {
        display: none !important;
    }
</style>
{% endblock %}

{% block content %}
<div class="qh-forgot-password-page" style="padding: 10px 0;">
    
    <div class="qh-auth-box">
        
        <h2 class="qh-auth-box-title">QUÊN MẬT KHẨU</h2>
        
        <!-- Steps indicator -->
        <div class="qh-steps">
            <div class="qh-step active" id="step1">
                <span class="qh-step-number">1</span>
                <span>Nhập email</span>
            </div>
            <div class="qh-step" id="step2">
                <span class="qh-step-number">2</span>
                <span>Nhập OTP</span>
            </div>
            <div class="qh-step" id="step3">
                <span class="qh-step-number">3</span>
                <span>Đổi mật khẩu</span>
            </div>
        </div>
        
        <!-- Messages -->
        {% if messages %}
            {% for message in messages %}
                <div class="qh-toast-message" data-type="{% if message.tags == 'error' %}error{% else %}success{% endif %}" data-message="{{ message|escapejs }}" style="display: none;"></div>
            {% endfor %}
        {% endif %}
        
        <!-- Step 1: Enter Email -->
        <div id="step1-form">
            <form id="emailForm">
                {% csrf_token %}
                <div class="qh-form-group">
                    <label class="qh-label">Email</label>
                    <div class="qh-otp-group">
                        <input type="email" name="email" id="email" class="qh-input" placeholder="Nhập email đã đăng ký" required>
                        <button type="button" class="qh-otp-btn" id="otpBtn" disabled>Gửi mã</button>
                    </div>
                </div>
                
                <!-- OTP Message -->
                <div id="otpMessage" class="qh-otp-message" style="display: none;"></div>
            </form>
        </div>
        
        <!-- Step 2: Enter OTP -->
        <div id="step2-form" class="qh-hidden">
            <form id="otpForm">
                {% csrf_token %}
                <input type="hidden" name="email" id="hiddenEmail">
                
                <div class="qh-form-group">
                    <label class="qh-label">Nhập mã OTP</label>
                    <input type="text" name="otp" id="otp" class="qh-input" placeholder="Nhập mã OTP đã gửi về email" required>
                </div>
                
                <button type="submit" class="qh-btn qh-btn-primary" style="width: 100%;">
                    Tiếp tục
                </button>

                                <div id="otpTimer" class="qh-otp-message" style="display: block; text-align: center; color: var(--qh-text-light);">
                    Mã có hiệu lực trong <span id="countdown">5:00</span>
                </div>
                
                <div style="text-align: center; margin-top: 12px;">
                    <button type="button" id="resendOtpBtn" class="qh-otp-btn" style="background: none; border: none; cursor: pointer; font-size: 14px; text-decoration: underline;" disabled>
                        Gửi lại mã OTP
                    </button>
                </div>
            </form>
        </div>
        
        <!-- Step 3: Reset Password -->
        <div id="step3-form" class="qh-hidden">
            <form id="resetPasswordForm">
                {% csrf_token %}
                <input type="hidden" name="email" id="resetEmail">
                
                <div class="qh-form-group">
                    <label class="qh-label">Mật khẩu mới</label>
                    <div class="qh-password-field">
                        <input type="password" name="new_password" id="newPassword" class="qh-input" placeholder="Nhập mật khẩu mới" required>
                        <button type="button" class="qh-password-toggle" onclick="togglePassword('newPassword')">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <div class="qh-form-group">
                    <label class="qh-label">Nhập lại mật khẩu mới</label>
                    <div class="qh-password-field">
                        <input type="password" name="confirm_password" id="confirmPassword" class="qh-input" placeholder="Nhập lại mật khẩu mới" required>
                        <button type="button" class="qh-password-toggle" onclick="togglePassword('confirmPassword')">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <div id="passwordMessage" class="qh-otp-message" style="display: none;"></div>
                
                <button type="submit" class="qh-btn qh-btn-primary" style="width: 100%;">
                    Lưu mật khẩu
                </button>
            </form>
        </div>
        
        <p class="qh-auth-link">
            Đã nhớ tài khoản? <a href="{% url 'store:login' %}">Đăng nhập ngay</a>
        </p>
    </div>
</div>

<script src="{% static 'js/forgot_password.js' %}"></script>

{% endblock %}
